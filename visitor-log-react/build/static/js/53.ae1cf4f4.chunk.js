"use strict";(self.webpackChunkvisitor_log=self.webpackChunkvisitor_log||[]).push([[53],{5414:function(e,t,r){r.r(t),r.d(t,{default:function(){return V}});var n=r(1413),s=r(9439),a=r(1971),i=r(6298),u=r(2998),c=r(4165),o=r(5861),l=r(28),d=r(2481),m=r(887),b=r(7467),h=(r(7366),r(2479)),p=r(1695),g=r(225),f=r(184);var x=function(){var e=(0,a.S)().setTimeActive,t=(0,d.hJ)(u.db,"visitors"),r=(0,l.b)(t),s=(0,m.Gc)(),i=s.register,x=s.reset,j=s.handleSubmit,v=s.formState,k=(0,d.IO)((0,d.hJ)(u.db,"users"),(0,d.ar)("uid","==",u.I8.currentUser.uid)),N=(0,h.J8)(k),w=(0,g.j)();function D(e){return Z.apply(this,arguments)}function Z(){return(Z=(0,o.Z)((0,c.Z)().mark((function t(n){return(0,c.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e(new Date),document.getElementById("submitNewVisitor").setAttribute("disabled","disabled"),I(n).then((function(e){null!==e&&(r.mutate({name:n.name.toUpperCase(),rank:n.rank.toUpperCase(),badge:parseInt(n.badge),org:n.org.toUpperCase(),dest:n.dest.toUpperCase(),escort:n.escort.toUpperCase(),created:new Date,signedOut:"null",dodaac:N.data[0].dodaac}),x(),(0,p.Kz)(u.co,"visitor_sign_in")),document.getElementById("submitNewVisitor").removeAttribute("disabled")}));case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function C(e,t){var r=!1;return e.forEach((function(e){e.name===t&&"null"===e.signedOut&&(r=!0),e.badge===t&&"null"===e.signedOut&&(r=!0)})),r}function I(e){return y.apply(this,arguments)}function y(){return(y=(0,o.Z)((0,c.Z)().mark((function e(t){var r,n,s,a;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.name.toUpperCase(),n=parseInt(t.badge),s=C(w,r),a=C(w,n),!s){e.next=7;break}return alert("There is already a user signed in with this name!"),e.abrupt("return",null);case 7:if(!a){e.next=10;break}return alert("This badge is already signed in!"),e.abrupt("return",null);case 10:return e.abrupt("return","valid");case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return(0,f.jsx)(f.Fragment,{children:(0,f.jsx)(b.Z,{trigger:(0,f.jsx)("button",{id:"manualSubmit",children:"Manual Submit"}),modal:!0,className:"visitors",children:function(t){return(0,f.jsxs)("div",{children:[(0,f.jsx)("h3",{children:"New Visitor"}),(0,f.jsx)("button",{style:{position:"absolute",top:"10px",right:"10px"},onClick:function(){x(),t(),e(new Date)},children:"X"}),(0,f.jsxs)("form",{onSubmit:j(D),children:[(0,f.jsx)("input",(0,n.Z)({type:"text",name:"formName",id:"formName",required:!0,placeholder:"Full Name"},i("name",{pattern:{value:/^[^0-9]+$/i,message:"Name must not contain numbers!"}}))),v.errors.name&&(0,f.jsx)("label",{className:"error",htmlFor:"formName",children:v.errors.name.message}),(0,f.jsx)("input",(0,n.Z)({type:"text",name:"formRank",id:"formRank",required:!0,placeholder:"Rank"},i("rank"))),(0,f.jsx)("input",(0,n.Z)({type:"number",name:"formBadge",id:"formbadge",required:!0,placeholder:"Badge"},i("badge",{min:{value:1,message:"Value must be greater than 0!"},max:{value:999,message:"Value must be less than 999!"}}))),v.badge&&(0,f.jsx)("label",{className:"error",htmlFor:"formBadge",children:v.badge.message}),(0,f.jsx)("input",(0,n.Z)({type:"text",name:"formOrg",id:"formOrg",required:!0,placeholder:"Organization"},i("org"))),(0,f.jsx)("input",(0,n.Z)({type:"text",name:"formDest",id:"formDest",required:!0,placeholder:"Destination"},i("dest"))),(0,f.jsx)("input",(0,n.Z)({type:"text",name:"formEscort",id:"formEscort",required:!0,placeholder:"Escort"},i("escort",{pattern:{value:/^[A-Za-z]+$/i,message:"Escort must not contain numbers!"}}))),v.escort&&(0,f.jsx)("label",{className:"error",htmlFor:"formEscort",children:v.escort.message}),(0,f.jsx)("button",{type:"submit",id:"submitNewVisitor",children:"Submit"})]})]})}})})};function j(){return(j=(0,o.Z)((0,c.Z)().mark((function e(t){var r,n,s;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===t){e.next=13;break}return r=(0,d.hJ)(u.db,"visitors"),n=(0,d.IO)(r,(0,d.ar)("badge","==",parseInt(t)),(0,d.ar)("signedOut","==","null")),e.next=5,(0,d.PL)(n);case 5:if(0===(s=e.sent).docs.length){e.next=12;break}return e.next=9,(0,d.r7)((0,d.JU)(u.db,"visitors",s.docs[0].id),{signedOut:new Date});case 9:(0,p.Kz)(u.co,"visitor_sign_out"),e.next=13;break;case 12:alert("This badge is not signed out");case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(){return(v=(0,o.Z)((0,c.Z)().mark((function e(t){var r,n,s,a;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=(0,d.hJ)(u.db,"DBIDS"),(n={}).name="";""===n.name;)n.name=prompt("Enter full name of personnel");if(null===n.name){e.next=14;break}return e.next=7,(0,d.ET)(r,{barcode:t,full_name:n.name.toUpperCase()});case 7:return s=e.sent,e.next=10,(0,d.QT)(s);case 10:return a=e.sent,e.abrupt("return",a);case 14:return e.abrupt("return",null);case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var k=function(e){return v.apply(this,arguments)};function N(e){return w.apply(this,arguments)}function w(){return(w=(0,o.Z)((0,c.Z)().mark((function e(t){var r,n,s,a,i;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={},n=(0,d.hJ)(u.db,"DBIDS"),s=(0,d.IO)(n,(0,d.ar)("barcode","==",t)),e.next=5,(0,d.PL)(s);case 5:if(0===(a=e.sent).docs.length){e.next=12;break}return r.FMN=a.docs[0].data().full_name,r.Rank="CIV",e.abrupt("return",r);case 12:if(!window.confirm("Barcode unable to be automatically read. Add personnel to global search list?")){e.next=26;break}return e.next=16,k(t);case 16:if(null===(i=e.sent)){e.next=23;break}return r.FMN=i.data().full_name,r.Rank="CIV",e.abrupt("return",r);case 23:case 26:return e.abrupt("return",null);case 24:e.next=27;break;case 27:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function D(){return(D=(0,o.Z)((0,c.Z)().mark((function e(t){var r,n,s;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.replace("'",""),n={},s={},e.t0=r.charAt(0),e.next="@"===e.t0?6:"N"===e.t0?9:"M"===e.t0?11:"4"===e.t0?13:"1"===e.t0?16:18;break;case 6:return console.log(-1!==r.search("ANSI")),-1!==r.search("ANSI")&&(n.Rank="CIV",(s=r.split(" ")).length<15&&(s=r.split("\r\n")),s.forEach((function(e){switch(e.substring(0,3)){case"DAC":void 0===n.FN&&(n.FN=e.substring(3,e.length));break;case"DAD":void 0===n.MI&&(n.MI=e.substring(3,e.length));break;case"DCS":void 0===n.LN&&(n.LN=e.substring(3,e.length));break;case"DCT":void 0===n.FMN&&(n.FMN=e.substring(3,e.length))}}))),e.abrupt("break",22);case 9:return 89===r.length&&(n.FN=r.substring(15,35).trim(),n.LN=r.substring(35,61).trim(),n.PCC=r.substring(65,66).trim(),n.Rank=r.substring(69,75).trim(),n.MI=r.substring(88,89).trim()),e.abrupt("break",22);case 11:return 99===r.length&&(n.FN=r.substring(16,36).trim(),n.MI=r.substring(36,37).trim(),n.LN=r.substring(37,63).trim(),n.PCC=r.substring(70,71).trim(),"M"===r.substring(80,85).charAt(0)&&(n.Rank=r.substring(74,79).trim()),"M"!==r.substring(80,85).charAt(0)&&(n.Rank=r.substring(79,84).trim())),e.abrupt("break",22);case 13:return 100===r.length&&(n.FN=r.substring(17,37).trim(),n.MI=r.substring(37,38).trim(),n.LN=r.substring(38,64).trim(),n.PCC=r.substring(71,72).trim(),n.Rank=r.substring(75,81).trim()),157===r.length&&(n.FN=r.substring(17,37).trim(),n.MI=r.substring(37,38).trim(),n.LN=r.substring(38,64).trim(),n.PCC=r.substring(128,129).trim(),n.Rank=r.substring(132,138).trim()),e.abrupt("break",22);case 16:return 88===r.length&&(n.FN=r.substring(15,35).trim(),n.LN=r.substring(35,61).trim(),n.PCC=r.substring(65,66).trim(),n.Rank=r.substring(60,66).trim()),e.abrupt("break",22);case 18:return e.next=20,N(t);case 20:return n=e.sent,e.abrupt("return",n);case 22:return e.abrupt("return",n);case 23:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Z=r(2791),C=r(7689),I=r(2426),y=r.n(I),S=r(9513),F=r.n(S),M=(r(8639),r(2791).useEffect),R=r(2791).useRef;function E(e,t){var r=R(null),n=R(e);return M((function(){n.current=e}),[e]),M((function(){if("number"===typeof t)return r.current=window.setInterval((function(){return n.current()}),t),function(){return window.clearInterval(r.current)}}),[t]),r}var O=function(){var e=new Date,t=(0,a.S)(),r=t.setTimeActive,n=t.timeout,c=t.timeoutWarn,o=(0,Z.useState)(0),l=(0,s.Z)(o,2),d=(l[0],l[1]),m=(0,Z.useState)("05:00"),h=(0,s.Z)(m,2),p=h[0],g=h[1],x=function(){r(new Date)};return E((function(){d((function(e){return e+1}))}),3e5),E((function(){g(y().utc(n-e).format("mm:ss")),e>=n&&(0,i.w7)(u.I8)}),e>=c?1e3:null),(0,f.jsx)(f.Fragment,{children:e>=c&&(0,f.jsx)("div",{children:(0,f.jsxs)(b.Z,{open:!0,closeOnDocumentClick:!1,closeOnEscape:!1,onClose:x,className:"timeout",children:[(0,f.jsxs)("div",{children:["You will be signed out due to inactivity in ",p]}),(0,f.jsx)("button",{className:"close",onClick:x,children:"Stay Logged In"})]})})})};var V=function(){var e=(0,a.S)(),t=e.currentUser,r=e.setTimeActive,c=(0,C.s0)(),o=(0,g.j)(),l=(0,m.cI)(),d=(0,Z.useState)([null,null]),h=(0,s.Z)(d,2),p=h[0],v=h[1],k=(0,s.Z)(p,2),N=k[0],w=k[1],I=function(e){null!==e&&function(e){return D.apply(this,arguments)}(e).then((function(e){null!==e&&(document.getElementById("manualSubmit").click(),"FMN"in e?l.setValue("name",e.FMN):l.setValue("name",e.LN+" "+e.FN+" "+e.MI.substring(0,1)),l.setValue("rank",e.Rank),l.setFocus("badge",{shouldSelect:!0}))}))};return(0,f.jsxs)("div",{className:"body",children:[(0,f.jsxs)("div",{className:"header",children:[(0,f.jsx)("h1",{children:"Visitor Log"}),(0,f.jsxs)("p",{children:["Logged in as: ",t.email,(0,f.jsx)("span",{onClick:function(){return(0,i.w7)(u.I8)},children:"Sign Out"})]})]}),(0,f.jsxs)("div",{className:"buttons",children:[(0,f.jsx)("button",{onClick:function(){var e=prompt("Scan ID");I(e),r(new Date)},children:"Scan ID"}),(0,f.jsx)(m.RV,(0,n.Z)((0,n.Z)({},l),{},{children:(0,f.jsx)(x,{})})),(0,f.jsx)("button",{onClick:function(){!function(e){j.apply(this,arguments)}(prompt("Enter Badge Number")),r(new Date)},children:"Sign Visitor Out"}),(0,f.jsxs)(b.Z,{trigger:(0,f.jsx)("button",{children:"Generate 1109"}),children:[(0,f.jsx)(F(),{required:!0,form:"generate1109",placeholderText:"Select 1109 Date Range",selectsRange:!0,onChange:function(e){return v(e)},startDate:N,endDate:w}),(0,f.jsx)("form",{id:"generate1109",onSubmit:function(e){e.preventDefault(),c("1109-pdf",{state:{startDate:N,endDate:w}})},children:(0,f.jsx)("button",{id:"button1109",type:"submit",children:"View/Download 1109"})})]}),(0,f.jsx)(O,{})]}),(0,f.jsxs)("div",{className:"table",children:[(0,f.jsxs)("table",{children:[(0,f.jsx)("thead",{children:(0,f.jsxs)("tr",{children:[(0,f.jsx)("th",{children:"Name"}),(0,f.jsx)("th",{children:"Rank"}),(0,f.jsx)("th",{children:"Organization"}),(0,f.jsx)("th",{children:"Destination"}),(0,f.jsx)("th",{children:"Escort"}),(0,f.jsx)("th",{children:"Badge"}),(0,f.jsx)("th",{children:"Signed In At"})]})}),(0,f.jsx)("tbody",{children:void 0!==o&&o.map((function(e){var t=y()(new Date(1e3*e.created.seconds)).format("DD MMM YY h:mm a");return(0,f.jsxs)("tr",{children:[(0,f.jsx)("td",{children:e.name}),(0,f.jsx)("td",{children:e.rank}),(0,f.jsx)("td",{children:e.org}),(0,f.jsx)("td",{children:e.dest}),(0,f.jsx)("td",{children:e.escort}),(0,f.jsx)("td",{children:e.badge}),(0,f.jsx)("td",{children:t})]},e.id)}))})]}),void 0===o&&(0,f.jsx)("div",{className:"loading-wheel"})]})]})}}}]);
//# sourceMappingURL=53.ae1cf4f4.chunk.js.map