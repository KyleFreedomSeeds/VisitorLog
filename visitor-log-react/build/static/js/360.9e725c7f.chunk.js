"use strict";(self.webpackChunkvisitor_log=self.webpackChunkvisitor_log||[]).push([[360],{9711:function(e,t,r){r.r(t),r.d(t,{default:function(){return E}});var n=r(1413),s=r(9439),a=r(1971),i=r(6298),u=r(2998),c=r(2481),o=r(4165),l=r(5861),d=r(28);function m(e){return b.apply(this,arguments)}function b(){return(b=(0,l.Z)((0,o.Z)().mark((function e(t){var r,n,s,a,i;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,c.hJ)(u.db,"visitors"),n=(0,c.IO)(r,(0,c.ar)("name","==",t.name.toUpperCase()),(0,c.ar)("signedOut","==","null")),e.next=4,(0,c.PL)(n);case 4:return s=e.sent,a=(0,c.IO)(r,(0,c.ar)("badge","==",parseInt(t.badge)),(0,c.ar)("signedOut","==","null")),e.next=8,(0,c.PL)(a);case 8:if(i=e.sent,0===s.docs.length){e.next=12;break}return alert("There is already a user signed in with this name!"),e.abrupt("return",null);case 12:if(0===i.docs.length){e.next=15;break}return alert("This badge is already signed in!"),e.abrupt("return",null);case 15:return e.abrupt("return","valid");case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var h=r(887),p=r(7467),g=(r(7366),r(2479)),f=r(1695),x=r(184);var j=function(){var e=(0,c.hJ)(u.db,"visitors"),t=(0,d.b)(e),r=(0,h.Gc)(),s=r.register,a=r.reset,i=r.handleSubmit,b=r.formState,j=(0,c.IO)((0,c.hJ)(u.db,"users"),(0,c.ar)("uid","==",u.I8.currentUser.uid)),k=(0,g.J8)(j);function v(e){return N.apply(this,arguments)}function N(){return(N=(0,l.Z)((0,o.Z)().mark((function e(r){return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:document.getElementById("submitNewVisitor").setAttribute("disabled","disabled"),m(r).then((function(e){null!==e&&(t.mutate({name:r.name.toUpperCase(),rank:r.rank.toUpperCase(),badge:parseInt(r.badge),org:r.org.toUpperCase(),dest:r.dest.toUpperCase(),escort:r.escort.toUpperCase(),created:new Date,signedOut:"null",dodaac:k.data[0].dodaac}),a(),(0,f.Kz)(u.co,"visitor_sign_in")),document.getElementById("submitNewVisitor").removeAttribute("disabled")}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return(0,x.jsx)(x.Fragment,{children:(0,x.jsx)(p.Z,{trigger:(0,x.jsx)("button",{id:"manualSubmit",children:"Manual Submit"}),modal:!0,className:"visitors",children:function(e){return(0,x.jsxs)("div",{children:[(0,x.jsx)("h3",{children:"New Visitor"}),(0,x.jsx)("button",{style:{position:"absolute",top:"10px",right:"10px"},onClick:function(){return e()},children:"X"}),(0,x.jsxs)("form",{onSubmit:i(v),children:[(0,x.jsx)("input",(0,n.Z)({type:"text",name:"formName",id:"formName",required:!0,placeholder:"Full Name"},s("name",{pattern:{value:/^[^0-9]+$/i,message:"Name must not contain numbers!"}}))),b.errors.name&&(0,x.jsx)("label",{className:"error",htmlFor:"formName",children:b.errors.name.message}),(0,x.jsx)("input",(0,n.Z)({type:"text",name:"formRank",id:"formRank",required:!0,placeholder:"Rank"},s("rank"))),(0,x.jsx)("input",(0,n.Z)({type:"number",name:"formBadge",id:"formbadge",required:!0,placeholder:"Badge"},s("badge",{min:{value:1,message:"Value must be greater than 0!"},max:{value:999,message:"Value must be less than 999!"}}))),b.badge&&(0,x.jsx)("label",{className:"error",htmlFor:"formBadge",children:b.badge.message}),(0,x.jsx)("input",(0,n.Z)({type:"text",name:"formOrg",id:"formOrg",required:!0,placeholder:"Organization"},s("org"))),(0,x.jsx)("input",(0,n.Z)({type:"text",name:"formDest",id:"formDest",required:!0,placeholder:"Destination"},s("dest"))),(0,x.jsx)("input",(0,n.Z)({type:"text",name:"formEscort",id:"formEscort",required:!0,placeholder:"Escort"},s("escort",{pattern:{value:/^[A-Za-z]+$/i,message:"Escort must not contain numbers!"}}))),b.escort&&(0,x.jsx)("label",{className:"error",htmlFor:"formEscort",children:b.escort.message}),(0,x.jsx)("button",{type:"submit",id:"submitNewVisitor",children:"Submit"})]})]})}})})};function k(){return(k=(0,l.Z)((0,o.Z)().mark((function e(t){var r,n,s;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===t){e.next=13;break}return r=(0,c.hJ)(u.db,"visitors"),n=(0,c.IO)(r,(0,c.ar)("badge","==",parseInt(t)),(0,c.ar)("signedOut","==","null")),e.next=5,(0,c.PL)(n);case 5:if(0===(s=e.sent).docs.length){e.next=12;break}return e.next=9,(0,c.r7)((0,c.JU)(u.db,"visitors",s.docs[0].id),{signedOut:new Date});case 9:(0,f.Kz)(u.co,"visitor_sign_out"),e.next=13;break;case 12:alert("This badge is not signed out");case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(){return(v=(0,l.Z)((0,o.Z)().mark((function e(t){var r,n,s,a;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=(0,c.hJ)(u.db,"DBIDS"),(n={}).name="";""===n.name;)n.name=prompt("Enter full name of personnel");if(null===n.name){e.next=14;break}return e.next=7,(0,c.ET)(r,{barcode:t,full_name:n.name.toUpperCase()});case 7:return s=e.sent,e.next=10,(0,c.QT)(s);case 10:return a=e.sent,e.abrupt("return",a);case 14:return e.abrupt("return",null);case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var N=function(e){return v.apply(this,arguments)};function I(e){return Z.apply(this,arguments)}function Z(){return(Z=(0,l.Z)((0,o.Z)().mark((function e(t){var r,n,s,a,i;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={},n=(0,c.hJ)(u.db,"DBIDS"),s=(0,c.IO)(n,(0,c.ar)("barcode","==",t)),e.next=5,(0,c.PL)(s);case 5:if(0===(a=e.sent).docs.length){e.next=12;break}return r.FMN=a.docs[0].data().full_name,r.Rank="CIV",e.abrupt("return",r);case 12:if(!window.confirm("Barcode unable to be automatically read. Add personnel to global search list?")){e.next=26;break}return e.next=16,N(t);case 16:if(null===(i=e.sent)){e.next=23;break}return r.FMN=i.data().full_name,r.Rank="CIV",e.abrupt("return",r);case 23:case 26:return e.abrupt("return",null);case 24:e.next=27;break;case 27:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(){return(w=(0,l.Z)((0,o.Z)().mark((function e(t){var r,n;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.replace("'",""),n={},{},e.t0=r.charAt(0),e.next="@"===e.t0?6:"N"===e.t0?8:"M"===e.t0?10:"4"===e.t0?13:"1"===e.t0?16:18;break;case 6:return-1!==r.search("ANSI")&&(n.Rank="CIV",r.split("\r\n").forEach((function(e){switch(e.substring(0,3)){case"DAC":void 0===n.FN&&(n.FN=e.substring(3,e.length));break;case"DAD":void 0===n.MI&&(n.MI=e.substring(3,e.length));break;case"DCS":void 0===n.LN&&(n.LN=e.substring(3,e.length));break;case"DCT":void 0===n.FMN&&(n.FMN=e.substring(3,e.length))}}))),e.abrupt("break",22);case 8:return 89===r.length&&(n.FN=r.substring(15,35).trim(),n.LN=r.substring(35,61).trim(),n.PCC=r.substring(65,66).trim(),n.Rank=r.substring(69,75).trim(),n.MI=r.substring(88,89).trim()),e.abrupt("break",22);case 10:return console.log("test M"),99===r.length&&(n.FN=r.substring(16,36).trim(),n.MI=r.substring(36,37).trim(),n.LN=r.substring(37,63).trim(),n.PCC=r.substring(70,71).trim(),"M"===r.substring(80,85).charAt(0)&&(n.Rank=r.substring(74,79).trim()),"M"!==r.substring(80,85).charAt(0)&&(n.Rank=r.substring(79,84).trim())),e.abrupt("break",22);case 13:return 100===r.length&&(n.FN=r.substring(17,37).trim(),n.MI=r.substring(37,38).trim(),n.LN=r.substring(38,64).trim(),n.PCC=r.substring(71,72).trim(),n.Rank=r.substring(75,81).trim()),157===r.length&&(n.FN=r.substring(17,37).trim(),n.MI=r.substring(37,38).trim(),n.LN=r.substring(38,64).trim(),n.PCC=r.substring(128,129).trim(),n.Rank=r.substring(132,138).trim()),e.abrupt("break",22);case 16:return 88===r.length&&(n.FN=r.substring(15,35).trim(),n.LN=r.substring(35,61).trim(),n.PCC=r.substring(65,66).trim(),n.Rank=r.substring(60,66).trim()),e.abrupt("break",22);case 18:return e.next=20,I(t);case 20:return n=e.sent,e.abrupt("return",n);case 22:return e.abrupt("return",n);case 23:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var C=r(2791),y=r(6461),D=r(199),S=r(1802),F=r(7689),M=r(2426),O=r.n(M),R=r(9513),V=r.n(R);r(8639);var E=function(){var e=(0,a.S)().currentUser,t=(0,F.s0)(),r=(0,C.useState)(),o=(0,s.Z)(r,2),l=o[0],d=o[1],m=(0,h.cI)(),b=(0,c.IO)((0,c.hJ)(u.db,"users"),(0,c.ar)("uid","==",e.uid)),g=(0,C.useState)([null,null]),f=(0,s.Z)(g,2),v=f[0],N=f[1],I=(0,s.Z)(v,2),Z=I[0],M=I[1];(0,C.useEffect)((function(){(0,y.BS)(b,{idField:"id"}).pipe((0,D.w)((function(e){return(0,S.a)(e.map((function(e){var t=(0,c.IO)((0,c.hJ)(u.db,"visitors"),(0,c.ar)("signedOut","==","null"),(0,c.ar)("dodaac","==",e.dodaac),(0,c.Xo)("created"));return(0,y.BS)(t,{idField:"id"})})))}))).subscribe((function(e){return d(e[0])}))}),[]);var R=function(e){null!==e&&function(e){return w.apply(this,arguments)}(e).then((function(e){null!==e&&(document.getElementById("manualSubmit").click(),console.log(e),"FMN"in e?m.setValue("name",e.FMN):m.setValue("name",e.LN+" "+e.FN+" "+e.MI.substring(0,1)),m.setValue("rank",e.Rank),m.setFocus("badge",{shouldSelect:!0}))}))};return(0,x.jsxs)("div",{className:"body",children:[(0,x.jsxs)("div",{className:"header",children:[(0,x.jsx)("h1",{children:"Visitor Log"}),(0,x.jsxs)("p",{children:["Logged in as: ",e.email,(0,x.jsx)("span",{onClick:function(){return(0,i.w7)(u.I8)},children:"Sign Out"})]})]}),(0,x.jsxs)("div",{className:"buttons",children:[(0,x.jsx)("button",{onClick:function(){var e=prompt("Scan ID");R(e)},children:"Scan ID"}),(0,x.jsx)(h.RV,(0,n.Z)((0,n.Z)({},m),{},{children:(0,x.jsx)(j,{})})),(0,x.jsx)("button",{onClick:function(){!function(e){k.apply(this,arguments)}(prompt("Enter Badge Number"))},children:"Sign Visitor Out"}),(0,x.jsxs)(p.Z,{trigger:(0,x.jsx)("button",{children:"Generate 1109"}),children:[(0,x.jsx)(V(),{required:!0,form:"generate1109",placeholderText:"Select 1109 Date Range",selectsRange:!0,onChange:function(e){return N(e)},startDate:Z,endDate:M}),(0,x.jsx)("form",{id:"generate1109",onSubmit:function(e){e.preventDefault(),t("1109-pdf",{state:{startDate:Z,endDate:M}})},children:(0,x.jsx)("button",{id:"button1109",type:"submit",children:"View/Download 1109"})})]})]}),(0,x.jsxs)("div",{className:"table",children:[(0,x.jsxs)("table",{children:[(0,x.jsx)("thead",{children:(0,x.jsxs)("tr",{children:[(0,x.jsx)("th",{children:"Name"}),(0,x.jsx)("th",{children:"Rank"}),(0,x.jsx)("th",{children:"Organization"}),(0,x.jsx)("th",{children:"Destination"}),(0,x.jsx)("th",{children:"Escort"}),(0,x.jsx)("th",{children:"Badge"}),(0,x.jsx)("th",{children:"Signed In At"})]})}),(0,x.jsx)("tbody",{children:void 0!==l&&l.map((function(e){var t=O()(new Date(1e3*e.created.seconds)).format("DD MMM YY h:mm a");return(0,x.jsxs)("tr",{children:[(0,x.jsx)("td",{children:e.name}),(0,x.jsx)("td",{children:e.rank}),(0,x.jsx)("td",{children:e.org}),(0,x.jsx)("td",{children:e.dest}),(0,x.jsx)("td",{children:e.escort}),(0,x.jsx)("td",{children:e.badge}),(0,x.jsx)("td",{children:t})]},e.id)}))})]}),void 0===l&&(0,x.jsx)("div",{className:"loading-wheel"})]})]})}}}]);
//# sourceMappingURL=360.9e725c7f.chunk.js.map